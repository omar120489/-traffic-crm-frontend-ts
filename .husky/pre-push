#!/usr/bin/env sh
set -euo pipefail

echo "üîç Running pre-push checks..."

# Always run from repo root (works even when hook runs from .husky/)
REPO_ROOT="$(git rev-parse --show-toplevel)"
cd "$REPO_ROOT"

# Optional: Node 20 guard (honors .nvmrc if present)
if [ -f "$REPO_ROOT/.nvmrc" ]; then
  REQUIRED_NODE="$(cat "$REPO_ROOT/.nvmrc" | tr -d '[:space:]')"
  CURRENT_NODE="$(node -v | sed 's/^v//')"
  case "$CURRENT_NODE" in
    20.*) : ;; # ok
    *)
      echo "‚ùå Node $CURRENT_NODE detected; Node $REQUIRED_NODE required. Run: nvm use $REQUIRED_NODE"
      exit 1
      ;;
  esac
fi

# Fast, focused check - use root typecheck script
pnpm typecheck

echo "‚úÖ TypeScript clean! Pushing..."
