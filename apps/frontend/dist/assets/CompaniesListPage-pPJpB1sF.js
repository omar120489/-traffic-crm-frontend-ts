import{importShared as E}from"./__federation_fn_import-CJIdJiQv.js";import{j as t}from"./useForkRef-BC7kqYKT.js";import{S as B,R as U}from"./typeof-1JE7jPjq.js";import{c as O}from"./createSvgIcon-J8zf_NKi.js";import{M as V}from"./MainCard-BRoTQIrC.js";import{a as j}from"./sdk-Dtz1-FIW.js";import{B as h}from"./Box-DmbfI6Tx.js";import{T as x}from"./Typography-DFd_zA1D.js";import{C as A}from"./Chip-clCeHopq.js";import{d as b}from"./Button-Bgis-uOM.js";import{T as $}from"./TextField-HqD_g_zo.js";import{I as q}from"./InputAdornment-D_aBeDhu.js";import{A as G}from"./Alert-C9XT2yne.js";import{D as _}from"./DataGrid-BrMsY6BD.js";const H=O(t.jsx("path",{d:"M10 16v-1H3.01L3 19c0 1.11.89 2 2 2h14c1.11 0 2-.89 2-2v-4h-7v1zm10-9h-4.01V5l-2-2h-4l-2 2v2H4c-1.1 0-2 .9-2 2v3c0 1.11.89 2 2 2h6v-2h4v2h6c1.1 0 2-.9 2-2V9c0-1.1-.9-2-2-2m-6 0h-4V5h4z"}));async function Y(n){return j.listCompanies(n)}async function Z(n){return j.getCompany(n)}async function J(n){return j.createCompany(n)}async function K(n,p){return j.updateCompany(n,p)}async function X(n){return j.deleteCompany(n)}const L={listCompanies:Y,getCompany:Z,createCompany:J,updateCompany:K,deleteCompany:X},{useCallback:C,useEffect:ee,useMemo:te,useState:I}=await E("react"),N={page:1,size:10,search:"",companySize:null};function ne(n){const[p,z]=I(()=>({...N,...n?.initialQuery??{}})),[f,g]=I(null),[S,m]=I(!1),[a,l]=I(null),u=te(()=>({...N,...p}),[p]),c=C(async i=>{const o=await L.listCompanies(i);g(o),l(null)},[]),y=C(async i=>{m(!0);try{await c(i)}catch(o){throw l(o),o}finally{m(!1)}},[c]);ee(()=>{let i=!0;return m(!0),L.listCompanies(u).then(o=>{i&&(g(o),l(null))}).catch(o=>{i&&l(o)}).finally(()=>{i&&m(!1)}),()=>{i=!1}},[u]);const F=C(i=>{z(o=>({...o,...i}))},[]),M=C(i=>{z(o=>({...o,...i(o)}))},[]),T=C(async()=>{await y(u)},[y,u]);return{companies:f?.items??[],data:f,loading:S,error:a,query:u,updateQuery:F,setQuery:M,refetch:T}}const{useCallback:w,useMemo:v}=await E("react"),{Link:P,useSearchParams:ae}=await E("react-router-dom"),D=10;function re(n){return n?new Intl.DateTimeFormat(void 0,{year:"numeric",month:"short",day:"numeric"}).format(new Date(n)):"—"}function Ce(){const[n,p]=ae(),z=v(()=>{const e=(s,d)=>{const W=Number(n.get(s));return Number.isFinite(W)&&W>0?W:d},r=s=>{const d=n.get(s);return d&&d.trim().length>0?d:void 0};return{page:e("page",1),size:e("size",D),search:n.get("search")??"",dateFrom:r("dateFrom"),dateTo:r("dateTo"),ownerId:r("ownerId")}},[n]),{companies:f,data:g,loading:S,error:m,query:a,updateQuery:l,refetch:u}=ne({initialQuery:z}),c=w(e=>{const r=new URLSearchParams(n);Object.entries(e).forEach(([s,d])=>{d===void 0||d===""?r.delete(s):r.set(s,d)}),p(r)},[n,p]),y=v(()=>{const e=n.get("stage");return e&&e.trim().length>0?e:void 0},[n]),F=v(()=>({page:Math.max(0,(a.page??1)-1),pageSize:Number(a.size??D)}),[a.page,a.size]),M=w(e=>{const r=e.page+1,s=e.pageSize;l({page:r,size:s}),c({page:String(r),size:String(s)})},[c,l]),T=w(e=>{const r=e.target.value;l({search:r,page:1});const s=r.trim();c({search:s.length>0?r:void 0,page:"1",size:String(a.size??D)})},[a.size,c,l]),i=w(()=>{u()},[u]),o=v(()=>!!((a.search??"").trim()||a.dateFrom||a.dateTo||a.ownerId||y),[a.dateFrom,a.dateTo,a.ownerId,a.search,y]),R=w(()=>{const e=a.size??D;l({page:1,size:e,search:"",dateFrom:void 0,dateTo:void 0,ownerId:void 0}),c({page:"1",size:String(e),search:void 0,dateFrom:void 0,dateTo:void 0,ownerId:void 0,stage:void 0})},[a.size,c,l]),k=v(()=>[{field:"name",headerName:"Company",flex:1,minWidth:220,renderCell:e=>t.jsxs(h,{sx:{display:"flex",flexDirection:"column",gap:.25},children:[t.jsx(x,{variant:"subtitle1",fontWeight:600,noWrap:!0,children:e.row.name}),t.jsxs(x,{variant:"caption",color:"text.secondary",noWrap:!0,children:["Owner: ",e.row.ownerId??"—"]})]})},{field:"domain",headerName:"Domain",flex:.8,minWidth:160,renderCell:e=>t.jsx(x,{variant:"body2",noWrap:!0,children:e.row.domain??"—"})},{field:"industry",headerName:"Industry",flex:.8,minWidth:160,renderCell:e=>t.jsx(x,{variant:"body2",noWrap:!0,children:e.row.industry??"—"})},{field:"size",headerName:"Size",flex:.6,minWidth:140,renderCell:e=>e.row.size?t.jsx(A,{label:e.row.size,size:"small",variant:"outlined"}):t.jsx(A,{label:"—",size:"small",variant:"outlined"})},{field:"updatedAt",headerName:"Updated",flex:.7,minWidth:150,renderCell:e=>t.jsx(x,{variant:"body2",noWrap:!0,children:re(e.row.updatedAt)})},{field:"actions",headerName:"Actions",sortable:!1,filterable:!1,minWidth:160,align:"right",disableColumnMenu:!0,renderCell:e=>{const r=t.jsx(b,{component:P,to:`/companies/${e.row.id}`,size:"small",children:"View"}),s=t.jsx(b,{component:P,to:`/companies/${e.row.id}/edit`,size:"small",color:"secondary",children:"Edit"});return t.jsxs(h,{sx:{display:"flex",flexDirection:"row",gap:1},children:[r,s]})}}],[]),Q=t.jsx(b,{component:P,to:"/companies/new",variant:"contained",startIcon:t.jsx(H,{}),children:"New Company"});return t.jsx(V,{title:"Companies",content:!1,children:t.jsxs(h,{sx:{display:"flex",flexDirection:"column",gap:2,p:3},children:[t.jsxs(h,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},gap:2,alignItems:{xs:"stretch",md:"center"},justifyContent:"space-between"},children:[t.jsx($,{fullWidth:!0,placeholder:"Search companies",value:a.search??"",onChange:T,slotProps:{input:{startAdornment:t.jsx(q,{position:"start",children:t.jsx(B,{fontSize:"small"})})}}}),t.jsxs(h,{sx:{display:"flex",flexDirection:"row",gap:1.5,justifyContent:{xs:"flex-start",md:"flex-end"}},children:[t.jsx(b,{variant:"outlined",startIcon:t.jsx(U,{}),onClick:i,disabled:S,children:"Refresh"}),Q]})]}),o&&t.jsx(A,{label:"Active filters",onDelete:R,color:"primary",size:"small",sx:{alignSelf:"flex-start"}}),!!m&&t.jsx(G,{severity:"error",children:m instanceof Error?m.message:"Failed to load companies. Please try again."}),t.jsx(h,{sx:{width:"100%"},children:t.jsx(_,{disableColumnMenu:!0,disableRowSelectionOnClick:!0,rows:f,columns:k,loading:S,getRowId:e=>e.id,paginationMode:"server",paginationModel:F,onPaginationModelChange:M,rowCount:g?.total??f.length,pageSizeOptions:[5,10,25,50],sx:{"& .MuiDataGrid-cell":{outline:"none !important"}}})}),t.jsx(h,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},gap:1,alignItems:{xs:"flex-start",sm:"center"}},children:t.jsxs(x,{variant:"caption",color:"text.secondary",children:["Showing ",f.length," of ",g?.total??0," companies"]})})]})})}export{Ce as default};
//# sourceMappingURL=CompaniesListPage-pPJpB1sF.js.map
