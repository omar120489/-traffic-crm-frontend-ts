import{importShared as E}from"./__federation_fn_import-CJIdJiQv.js";import{j as t}from"./useForkRef-BC7kqYKT.js";import{S as B,R as U}from"./typeof-1JE7jPjq.js";import{P as O}from"./PersonAddAlt1-D73X94MS.js";import{M as $}from"./MainCard-BRoTQIrC.js";import{a as v}from"./sdk-Dtz1-FIW.js";import{B as f}from"./Box-DmbfI6Tx.js";import{T as x}from"./Typography-DFd_zA1D.js";import{C as W}from"./Chip-clCeHopq.js";import{d as I}from"./Button-Bgis-uOM.js";import{T as q}from"./TextField-HqD_g_zo.js";import{I as G}from"./InputAdornment-D_aBeDhu.js";import{A as _}from"./Alert-C9XT2yne.js";import{D as H}from"./DataGrid-BrMsY6BD.js";async function V(){return v.listContacts()}async function Y(n){return v.getContact(n)}async function Z(n){return v.createContact(n)}async function J(n,h){return v.updateContact(n,h)}async function K(n){return v.deleteContact(n)}const M={listContacts:V,getContact:Y,createContact:Z,updateContact:J,deleteContact:K},{useCallback:C,useEffect:X,useMemo:ee,useState:b}=await E("react"),k={page:1,size:10,search:""};function te(n){const[h,S]=b(()=>({...k,...n?.initialQuery??{}})),[p,g]=b(null),[z,m]=b(!1),[a,c]=b(null),u=ee(()=>({...k,...h}),[h]),l=C(async s=>{const o=await M.listContacts(s);g(o),c(null)},[]),y=C(async s=>{m(!0);try{await l(s)}catch(o){throw c(o),o}finally{m(!1)}},[l]);X(()=>{let s=!0;return m(!0),M.listContacts(u).then(o=>{s&&(g(o),c(null))}).catch(o=>{s&&c(o)}).finally(()=>{s&&m(!1)}),()=>{s=!1}},[u]);const D=C(s=>{S(o=>({...o,...s}))},[]),P=C(s=>{S(o=>({...o,...s(o)}))},[]),A=C(async()=>{await y(u)},[y,u]);return{contacts:p?.items??[],data:p,loading:z,error:a,query:u,updateQuery:D,setQuery:P,refetch:A}}const{useCallback:w,useMemo:j}=await E("react"),{Link:N,useSearchParams:ne}=await E("react-router-dom"),F=10;function ae(n){return n?new Intl.DateTimeFormat(void 0,{year:"numeric",month:"short",day:"numeric"}).format(new Date(n)):"—"}function re(n){return n||"—"}function Ce(){const[n,h]=ne(),S=j(()=>{const e=(i,d)=>{const T=Number(n.get(i));return Number.isFinite(T)&&T>0?T:d},r=i=>{const d=n.get(i);return d&&d.trim().length>0?d:void 0};return{page:e("page",1),size:e("size",F),search:n.get("search")??"",dateFrom:r("dateFrom"),dateTo:r("dateTo"),ownerId:r("ownerId")}},[n]),{contacts:p,data:g,loading:z,error:m,query:a,updateQuery:c,refetch:u}=te({initialQuery:S}),l=w(e=>{const r=new URLSearchParams(n);Object.entries(e).forEach(([i,d])=>{d===void 0||d===""?r.delete(i):r.set(i,d)}),h(r)},[n,h]),y=j(()=>{const e=n.get("stage");return e&&e.trim().length>0?e:void 0},[n]),D=j(()=>({page:Math.max(0,(a.page??1)-1),pageSize:a.size??F}),[a.page,a.size]),P=w(e=>{const r=e.page+1,i=e.pageSize;c({page:r,size:i}),l({page:String(r),size:String(i)})},[l,c]),A=w(e=>{const r=e.target.value;c({search:r,page:1});const i=r.trim();l({search:i.length>0?r:void 0,page:"1",size:String(a.size??F)})},[a.size,l,c]),s=w(()=>{u()},[u]),o=j(()=>!!((a.search??"").trim()||a.dateFrom||a.dateTo||a.ownerId||y),[a.dateFrom,a.dateTo,a.ownerId,a.search,y]),L=w(()=>{const e=a.size??F;c({page:1,size:e,search:"",dateFrom:void 0,dateTo:void 0,ownerId:void 0}),l({page:"1",size:String(e),search:void 0,dateFrom:void 0,dateTo:void 0,ownerId:void 0,stage:void 0})},[a.size,l,c]),R=j(()=>[{field:"name",headerName:"Contact",flex:1,minWidth:220,renderCell:e=>t.jsxs(f,{sx:{display:"flex",flexDirection:"column",gap:.25},children:[t.jsxs(x,{variant:"subtitle1",fontWeight:600,noWrap:!0,children:[e.row.firstName," ",e.row.lastName]}),t.jsxs(x,{variant:"caption",color:"text.secondary",noWrap:!0,children:["Owner: ",e.row.ownerId??"—"]})]})},{field:"email",headerName:"Email",flex:1,minWidth:220},{field:"phone",headerName:"Phone",flex:.6,minWidth:140,renderCell:e=>t.jsx(x,{variant:"body2",noWrap:!0,children:re(e.row.phone)})},{field:"title",headerName:"Title",flex:.8,minWidth:160,renderCell:e=>t.jsx(x,{variant:"body2",noWrap:!0,children:e.row.title??"—"})},{field:"companyId",headerName:"Company",flex:.8,minWidth:160,renderCell:e=>e.row.companyId?t.jsx(W,{label:e.row.companyId,size:"small",variant:"outlined"}):t.jsx(W,{label:"—",size:"small",variant:"outlined"})},{field:"updatedAt",headerName:"Updated",flex:.7,minWidth:150,renderCell:e=>t.jsx(x,{variant:"body2",noWrap:!0,children:ae(e.row.updatedAt)})},{field:"actions",headerName:"Actions",sortable:!1,filterable:!1,minWidth:160,align:"right",disableColumnMenu:!0,renderCell:e=>{const r=t.jsx(I,{component:N,to:`/contacts/${e.row.id}`,size:"small",children:"View"}),i=t.jsx(I,{component:N,to:`/contacts/${e.row.id}/edit`,size:"small",color:"secondary",children:"Edit"});return t.jsxs(f,{sx:{display:"flex",flexDirection:"row",gap:1},children:[r,i]})}}],[]),Q=t.jsx(I,{component:N,to:"/contacts/new",variant:"contained",startIcon:t.jsx(O,{}),children:"New Contact"});return t.jsx($,{title:"Contacts",content:!1,children:t.jsxs(f,{sx:{display:"flex",flexDirection:"column",gap:2,p:3},children:[t.jsxs(f,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},gap:2,alignItems:{xs:"stretch",md:"center"},justifyContent:"space-between"},children:[t.jsx(q,{fullWidth:!0,placeholder:"Search contacts",value:a.search??"",onChange:A,InputProps:{startAdornment:t.jsx(G,{position:"start",children:t.jsx(B,{fontSize:"small"})})}}),t.jsxs(f,{sx:{display:"flex",flexDirection:"row",gap:1.5,justifyContent:{xs:"flex-start",md:"flex-end"}},children:[t.jsx(I,{variant:"outlined",startIcon:t.jsx(U,{}),onClick:s,disabled:z,children:"Refresh"}),Q]})]}),o&&t.jsx(W,{label:"Active filters",onDelete:L,color:"primary",size:"small",sx:{alignSelf:"flex-start"}}),!!m&&t.jsx(_,{severity:"error",children:m instanceof Error?m.message:"Failed to load contacts. Please try again."}),t.jsx(f,{sx:{width:"100%"},children:t.jsx(H,{autoHeight:!0,disableColumnMenu:!0,disableRowSelectionOnClick:!0,rows:p,columns:R,loading:z,getRowId:e=>e.id,paginationMode:"server",paginationModel:D,onPaginationModelChange:P,rowCount:g?.total??p.length,pageSizeOptions:[5,10,25,50],sx:{"& .MuiDataGrid-cell":{outline:"none !important"}}})}),t.jsx(f,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},gap:1,alignItems:{xs:"flex-start",sm:"center"}},children:t.jsxs(x,{variant:"caption",color:"text.secondary",children:["Showing ",p.length," of ",g?.total??0," contacts"]})})]})})}export{Ce as default};
//# sourceMappingURL=ContactsListPage-DyfSm_AU.js.map
